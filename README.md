# HoTT-Case-Study
## HoTT for the Working Mathematician : A Case Study

This projects aims to exemplify how homotopy type theory can handle a common practice in informal mathematics without violating its spirit, namely "arguing up to isomorphisms".

A striking example of this practice is described by Kevin Buzzard when he [reports](https://www.icms.org.uk/downloads/bigproof/Buzzard.pdf) on his [formalization of perfectoid spaces](https://leanprover-community.github.io/lean-perfectoid-spaces/) together with Johan Commelin and Patrick Massot: When you iterate localizations of a ring by inverting several elements, you often want to work instead with a one-step localization, by inverting the product of the elements. Mathematicians immediately assert that both localized rings are uniquely isomorphic and use them interchangeably without bothering any longer - for proof checkers, this becomes a much more serious problem. In particular, it is not possible to apply rewrite-tactics as long as there is no actual equality but just isomorphisms.

Homotopy type theory (HoTT) with its careful analysis of equality and its univalent foundations (UF) is perfectly suited to deal with this situation: Isomorphisms will be equivalent to equalities of localized rings, and standard rewrite tactics apply. To formalize this statement, a trick attributed by Kevin Buzzard to Neil Strickland can deploy its full power: 
> Characterize an object with a universal property by predicates that imply the universal property.

HoTT/UF then not only allows to deduce unique isomorphisms between objects satisfying these predicates but equality.

Instances of this trick are already useful in set theory, but homotopy type theory also clarifies other aspects of sets: 
* First of all, and in marked contrast to [mathlib in Lean 3](https://leanprover-community.github.io/mathlib-overview.html), sets in HoTT are types whose derived equality types satisfy a certain property, and are not given as predicates on types. To me, having different types of sets according to the type of their elements sounds more like the concept of a subset. 

* Furthermore, the idea at the very heart of homotopy type theory can be exemplified by discussing the following question: "When are two sets equal?" The classical answer is "if the two sets have the same elements", but that contradicts the paradigm of type theory that every object must have a type, so objects of different type cannot be equal. An answer consistent with type theory is "if there is a bijection between the two sets" - but then there will be lots of different equalities between two given sets, a hallmark of homotopy type theory. The easy half of univalence yields such a bijection from an equality, the difficult half (which is the actual Univalence Axiom) provides you with an equality given a bijection.

* Mathematicians who take a look at HoTT sometimes [dislike univalence](https://xenaproject.wordpress.com/2020/02/09/where-is-the-fashionable-mathematics/) because it seems to produce equalities too easily. But in the case of sets the procedure only works because sets do not give any extra information on their elements. As soon as the sets have extra structure equalities in HoTT need to take into account this extra structure, leading to isomorphisms - that's why all number fields are *not* equal in HoTT.

* A proof of the equivalence of equalities and bijections of sets can be found in [set_theory.hlean](https://github.com/theckl/HoTT-Case-Study/blob/master/Lean2-HoTT/set_theory.hlean). By the way, this shows in HoTT that the type of sets is not a set: There are too many different bijections between two bijective sets.  

* Strickland's trick can be used to define a subset as a set with an injective map to the ambient set. The universal property satisfied by subsets is the right cancelling property of maps from arbitrary sets to the ambient set factorizing through the subset. The uniqueness implied by the universal property actually shows that the power set of a set is a set itself because the only equality between two subsets is given by the unique bijection between the underlying sets compatible with the inclusion maps. These definitions and proofs are contained in [subset.hlean](https://github.com/theckl/HoTT-Case-Study/blob/master/Lean2-HoTT/subset.hlean).

* Of course one can also extract a predicate from the description of a subset as above, and vice versa, as done in [subset.hlean](https://github.com/theckl/HoTT-Case-Study/blob/master/subset.hlean). But this description allows to construct substructures of any sort, and such constructions are completely missing in the [Lean 2 HoTT library](https://github.com/leanprover/lean2/blob/master/hott/hott.md): A subobject of an object with a given structure also satisfies the structure and has an injective homomorphism to the ambient object. In that way you can define submonoids with respect to which a ring can be localized. All that will be formalized in the file [substructure.hlean](https://github.com/theckl/HoTT-Case-Study/blob/master/substructure.hlean).

* Localization is dual to the substructure construction, as its construction is based on homomorphisms from the ring to its localization. Uniqueness implies the (constructive) existence of isomorphisms, which is equivalent to the existence of equalities by univalence. We also want to reprove some of the lemmas in the [formalization of schemes](https://github.com/ramonfmir/lean-scheme) and maybe perfectoid spaces 
where these isomorphism are used. This material will be contained in [localization.hlean](https://github.com/theckl/HoTT-Case-Study/blob/master/localization.hlean). 

* Hopefully, the project can be extended to include a formalization of schemes using HoTT, thus allowing more thorough comparisons.

At the moment, the formalization is done in [Lean 2](https://github.com/leanprover/lean2) using the extensive [HoTT library](https://github.com/leanprover/lean2/blob/master/hott/hott.md) of van Doorn, von Raumer and Buchholtz. Note that the [frozen version of Lean 2](https://github.com/leanprover/lean2) can still be installed and works well in the HoTT mode. Unfortunately, for intrinsic logical reasons this library could only be [ported to Lean 3](https://github.com/gebner/hott3) using some tricks, which I need to test further before relying on them. The advantage would be of course that the formalization could use the incredibly handy infrastructure built by the Lean 3 community. 

This project wants to spark the working mathematicians' interest in using homotopy type theory in everyday's mathematics. It also provides a first glimpse why homotopy type theory can be instrumental for the next big step(s) in the change from informal to formal mathematics: After the big proofs collecting many small cases like the 4-color theorem, the Thompson-Feit theorem and of course the proof of the Kepler Conjecture, after the formalization of intricate concepts like perfectoid spaces relying on a deep hierarchy of mathematical notions, the next step should be to formalize intricate theorems and, even better, conjectures on which people actually work at the moment. Thomas Hales initiated the [Formal Abstracts project](https://formalabstracts.github.io/) in 2017 along these lines.

A good example could be Bloch's Conjecture, a very deep prediction on the size of certain parameter spaces of points on complex algebraic surfaces from their cohomology groups.
Joseph Ayoub recently [presented a suggestion for a proof](https://www.youtube.com/watch?v=DIZHXXIH25E), but it was rejected after some time because the localization techniques (yes, indeed) used on categories were considered to be too advanced to be trusted. Homotopy type theory might really contribute to this piece of ["fashionable mathematics"](https://xenaproject.wordpress.com/2020/02/09/where-is-the-fashionable-mathematics/).

The ultimate hope is that such developments might motivate the Lean developers to open the door to homotopy type theory again in the new Lean versions. At the moment I do not see a better ecosystem to formalize mathematics than what exists around Lean 3. But I may be way too optimistic in that hope (or too pessimistic, and Ebner's and van Doorn's HoTT library in Lean 3 is convenient to use).
